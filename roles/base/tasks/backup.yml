---

- name: Install python-psutil package
  shell: pip3 install psutil

- name: Set to make backup
  dconf: key="/org/gnome/deja-dup/periodic" value="true"
  become_user: "{{item}}"
  with_items:
    - wroman
    - jesus
  ignore_errors: true

- name: Set to make backup weekly
  dconf: key="/org/gnome/deja-dup/periodic-period" value="7"
  become_user: "{{item}}"
  with_items:
    - wroman
    - jesus
  ignore_errors: true

- name: Set lockation type of backups
  become: false  
  dconf: key="/org/gnome/deja-dup/backend" value="'remote'"
  become_user: "{{item}}"
  with_items:
    - wroman
    - jesus
  ignore_errors: true

# user wroman config

- name: Set remote URI for host wroman
  become_user: wroman 
  dconf: key="/org/gnome/deja-dup/remote/uri" value="'smb://synology/wroman'"
  when: "ansible_hostname in ['wroman']"

- name: Set remote FOLDER for host wroman
  become_user: wroman
  dconf: key="/org/gnome/deja-dup/remote/folder" value="'/'"
  when: "ansible_hostname in ['wroman']" 

- name: Set WHAT TO BACKUP for host wroman
  become_user: wroman
  dconf: key="/org/gnome/deja-dup/include-list" value="['/home/wroman']"
  when: "ansible_hostname in ['wroman']"

# user jesus config

- name: Set remote URI for host jesus
  become_user: jesus
  dconf: key="/org/gnome/deja-dup/remote/uri" value="'smb://synology/jesus'"
  when: "ansible_hostname in ['jesus']"

- name: Set remote FOLDER for host jesus
  become_user: jesus
  dconf: key="/org/gnome/deja-dup/remote/folder" value="'/'"
  when: "ansible_hostname in ['jesus']" 

- name: Set WHAT TO BACKUP for host jesus
  become_user: jesus
  dconf: key="/org/gnome/deja-dup/include-list" value="['/home/jesus']"
  when: "ansible_hostname in ['jesus']"

